import{r as e,j as a}from"./react-vendor-DZn__gkT.js";import{t as i,B as t}from"./button-D0Qpo6P0.js";import{u as s,g as o,l}from"./index-Nz6lSWE-.js";import{d as n,p as r,a as d,b as c,c as u}from"./tooltip-BeXph3-U.js";import{U as p,o as m,H as f,r as v,s as h,D as b}from"./ui-utils-vendor-CIi_yc8Y.js";import"./radix-vendor-DUrlxRPG.js";const _=({onEditScript:_,videoFileIdentifier:g,audioFileIdentifier:y,videoOriginalName:k,audioOriginalName:w,currentVoiceModel:x,taskIds:S,onTaskIdUpdate:N,onFileSelected:j})=>{const{lipsyncSettings:F}=s(),[C,T]=e.useState(0),[R,z]=e.useState(0),[E,M]=e.useState(0),[U,A]=e.useState(0),[D,I]=e.useState(0),[L,V]=e.useState(null),[$,P]=e.useState({uploadTask:null,voiceTask:null,audioTask:null,lipSyncTask:null}),B=S||$,q=(e,a)=>{P((i=>({...i,[e]:a}))),N&&N(e,a)},H=e.useRef(null),O=e.useRef(null),W=e.useRef(null),K=({icon:e,label:i,onClick:s,progress:o,disabled:l,className:n,tooltipContent:r})=>{const p=a.jsxs(t,{onClick:s,className:`w-full flex gap-2 items-center justify-start bg-gray-800 hover:bg-gray-700 text-white border-gray-700 ${n||""}`,disabled:l,variant:"outline",children:[a.jsx(e,{className:"h-4 w-4"}),a.jsx("span",{children:i})]});return a.jsxs("div",{className:"w-full flex flex-col gap-2 mb-4",children:[r?a.jsxs(d,{children:[a.jsx(c,{asChild:!0,children:p}),a.jsx(u,{children:r})]}):p,a.jsx("div",{className:"w-full bg-gray-800 rounded-full h-4 border border-purple-300/30",children:a.jsx("div",{className:`h-full rounded-full ${o&&o>0?"bg-purple-600":"bg-gray-700"} transition-all`,style:{width:`${o||0}%`},children:o&&o>0&&a.jsxs("span",{className:"block text-xs text-white text-center font-bold leading-4",children:[Math.round(o),"%"]})})})]})},Q=g&&y?`Ready to lip sync ${k||"video"} with ${w||"audio"}?`:"Upload both a video file and an audio file to enable lip sync";return e.useEffect((()=>{if(L)if(L.startsWith("http"))V(L);else{const e=L.startsWith("/")?L:`/${L}`;V(e)}}),[L]),e.useEffect((()=>{}),[g,y]),a.jsxs("div",{className:"w-64 bg-[#1a1a2e] border-r border-gray-800 p-4 flex flex-col h-full",children:[a.jsx("h2",{className:"text-lg font-bold mb-6 text-white",children:"CloneSync"}),a.jsx("input",{type:"file",ref:H,onChange:async e=>{var a;const t=null==(a=e.target.files)?void 0:a[0];if(t){T(0);try{const e=await n(o("/api/v1/upload/video"),t,(e=>T(e)));e.task_id&&(q("uploadTask",e.task_id),r(e.task_id,(e=>T(e))).then((e=>{var a;i({title:"Upload Complete",description:"Video upload and processing completed successfully."}),j&&(null==(a=null==e?void 0:e.data)?void 0:a.filename)&&j("video",e.data.filename,t.name)})).catch((e=>{})))}catch(s){}}},accept:"video/*",className:"hidden"}),a.jsx("input",{type:"file",ref:O,onChange:async e=>{var a;const t=null==(a=e.target.files)?void 0:a[0];if(t){z(0);try{const e=await n(o("/api/v1/upload/voice"),t,(e=>z(e)));e.task_id&&(q("voiceTask",e.task_id),r(e.task_id,(e=>z(e))).then((e=>{var a;i({title:"Voice Model Ready",description:"Voice model was uploaded and processed successfully."}),j&&(null==(a=null==e?void 0:e.data)?void 0:a.filename)&&j("voice",e.data.filename,t.name)})).catch((e=>{})))}catch(s){}}},accept:".zip,.pth,audio/*",className:"hidden"}),a.jsx("input",{type:"file",ref:W,onChange:async e=>{var a;const t=null==(a=e.target.files)?void 0:a[0];if(t){M(0);try{const e=await n(o("/api/v1/upload/audio"),t,(e=>M(e)));e.task_id&&(q("audioTask",e.task_id),r(e.task_id,(e=>M(e))).then((e=>{var a;i({title:"Audio Ready",description:"Audio was uploaded and processed successfully."}),j&&(null==(a=null==e?void 0:e.data)?void 0:a.filename)&&j("audio",e.data.filename,t.name)})).catch((e=>{})))}catch(s){}}},accept:"audio/*",className:"hidden"}),a.jsxs("div",{className:"mt-12",children:[a.jsx(K,{icon:p,label:"Upload Video",onClick:()=>{H.current&&H.current.click()},progress:C,tooltipContent:"Select a video file for processing"}),a.jsx(K,{icon:m,label:"Upload Voice Model",onClick:()=>{O.current&&O.current.click()},progress:R,tooltipContent:"Upload training data or a pre-trained model (.pth/.zip)"}),a.jsx(K,{icon:f,label:"Upload Audio",onClick:()=>{W.current&&W.current.click()},progress:E,tooltipContent:"Select an audio file for TTS or lip sync source"}),a.jsx(K,{icon:v,label:"Edit Script",onClick:()=>{_&&_()},progress:D,tooltipContent:"Edit the text script for TTS generation"}),a.jsx(K,{icon:h,label:"Start Lip Sync",onClick:async()=>{var e;if(g&&y){A(0),V(null);try{const a=F.algorithm||"wav2lip",t={};if("wav2lip"===a){const e=[F.pads.top??0,F.pads.bottom??0,F.pads.left??0,F.pads.right??0],a=Number.isFinite(F.resizeFactor)?F.resizeFactor:1;t.wav2lip={pads:e,resize_factor:a,nosmooth:F.nosmooth,batch_size:Number.isFinite(F.batchSize)?F.batchSize:void 0,volume_amplification:Number.isFinite(F.volumeAmplification)?F.volumeAmplification:void 0,delay_start_time:Number.isFinite(F.delayStartTime)?F.delayStartTime:void 0,mask_dilate:Number.isFinite(F.maskDilate)?F.maskDilate:void 0,mask_blur:Number.isFinite(F.maskBlur)?F.maskBlur:void 0,use_enhancer:F.useEnhancer,use_background_enhancer:F.useBackgroundEnhancer,preprocess_mode:F.preprocessMode,enable_face_swap:F.enableFaceSwap,face_swap_image:F.faceSwapImage,zero_mouth:F.zeroMouth,show_frame_number:F.showFrameNumber,enable_keyframe_manager:F.enableKeyframeManager,auto_mask:F.autoMask,driving_video:F.drivingVideo,driving_avatar:F.drivingAvatar,enable_comfy_ui:F.enableComfyUI}}else"sadtalker"===a?t.sadtalker={still_mode:F.stillMode,use_enhancer:F.useEnhancer,preprocess_mode:F.preprocessMode,pose_style:Number.isFinite(F.poseStyle)?F.poseStyle:0,batch_size:Number.isFinite(F.batchSize)?F.batchSize:2,expression_scale:Number.isFinite(F.expressionScale)?F.expressionScale:1,ref_eyeblink:F.refEyeblink,ref_pose:F.refPose,face3d_vis:F.face3dVis,input_yaw:F.inputYaw,input_pitch:F.inputPitch,input_roll:F.inputRoll}:"geneface"===a&&(t.geneface={quality:null==(e=F.quality)?void 0:e.toString(),frame_rate:Number.isFinite(F.frameRate)?F.frameRate:void 0,expression_intensity:Number.isFinite(F.expressionIntensity)?F.expressionIntensity:void 0,upscale_factor:Number.isFinite(F.upscaleFactor)?F.upscaleFactor:void 0,audio_sample_rate:Number.isFinite(F.audioSampleRate)?F.audioSampleRate:void 0,use_high_quality_mode:F.useHighQualityMode,neural_model_type:F.neuralModelType,enable_post_processing:F.enablePostProcessing,preserve_background:F.preserveBackground,enable_super_resolution:F.enableSuperResolution,gpu_acceleration:F.gpuAcceleration,precision:F.precision,enable_audio_preprocessing:F.enableAudioPreprocessing,enable_audio_normalization:F.enableAudioNormalization});const s={engine:a,audio:y,video:g,options:t},o=async e=>{try{const a=await r(e,(()=>{}));return a&&a.data&&a.data.output_url?a.data.output_url:null}catch(a){return null}},n=await l.start(s);if(!n||!n.task_id)throw new Error(n.error||"Failed to get task ID from lipsync start response");q("lipSyncTask",n.task_id),i({title:"Lip Sync Started",description:`Task ${n.task_id} initiated for ${s.engine}.`}),r(n.task_id,(e=>A(e))).then((e=>{var a;i({title:"Lip Sync Complete",description:"Processing completed successfully."}),(null==(a=null==e?void 0:e.data)?void 0:a.output_url)?V(e.data.output_url):o(n.task_id).then((e=>{e&&V(e)})).catch((e=>{}))})).catch((e=>{i({title:"Lip Sync Failed",description:e instanceof Error?e.message:"Processing failed",variant:"destructive"})}))}catch(a){i({title:"Lip Sync Failed",description:a instanceof Error?a.message:"Failed to start process",variant:"destructive"}),A(0)}}else i({title:"Missing Files",description:"Backend identifiers for video and audio are missing. Ensure files were uploaded successfully.",variant:"destructive"})},progress:U,disabled:!g||!y,className:g&&y?"bg-purple-600 hover:bg-purple-700 text-white border-purple-700":void 0,tooltipContent:Q}),a.jsx(K,{icon:b,label:"Download Result",onClick:()=>{if(L)window.open(L,"_blank");else if(B.lipSyncTask){i({title:"Fetching Download Link",description:"Trying to retrieve the download URL..."});(async e=>{try{const a=await r(e,(()=>{}));return a&&a.data&&a.data.output_url?a.data.output_url:null}catch(a){return null}})(B.lipSyncTask).then((e=>{e?(V(e),window.open(e,"_blank")):i({title:"Download Not Available",description:"The download URL is not available yet. The processing may still be in progress.",variant:"destructive"})})).catch((e=>{i({title:"Download Error",description:"Failed to retrieve the download URL.",variant:"destructive"})}))}else i({title:"No Download Available",description:"No completed lipsync task found to download.",variant:"destructive"})},disabled:U<100,tooltipContent:"Download the processed output file (available after completion)"})]})]})};export{_ as default};
