const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Header-0obamvo2.js","./react-vendor-DZn__gkT.js","./radix-vendor-DUrlxRPG.js","./ui-utils-vendor-CIi_yc8Y.js","./button-D0Qpo6P0.js","./select--geUwo6J.js","./tooltip-BnvOMnZg.js","./Sidebar-BQRjCmiW.js","./VideoPlayer-C1tvV8o4.js","./runpodTest-DOassHFb.js"])))=>i.map(i=>d[i]);
import{r as e,j as t,c as r,d as a}from"./react-vendor-DZn__gkT.js";import{P as s}from"./radix-vendor-DUrlxRPG.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const n={},o=function(e,t,r){let a=Promise.resolve();if(t&&t.length>0){const e=document.getElementsByTagName("link"),s=document.querySelector("meta[property=csp-nonce]"),o=(null==s?void 0:s.nonce)||(null==s?void 0:s.getAttribute("nonce"));a=Promise.allSettled(t.map((t=>{if(t=function(e,t){return new URL(e,t).href}(t,r),t in n)return;n[t]=!0;const a=t.endsWith(".css"),s=a?'[rel="stylesheet"]':"";if(!!r)for(let r=e.length-1;r>=0;r--){const s=e[r];if(s.href===t&&(!a||"stylesheet"===s.rel))return}else if(document.querySelector(`link[href="${t}"]${s}`))return;const i=document.createElement("link");return i.rel=a?"stylesheet":"modulepreload",a||(i.as="script"),i.crossOrigin="",i.href=t,o&&i.setAttribute("nonce",o),document.head.appendChild(i),a?new Promise(((e,r)=>{i.addEventListener("load",e),i.addEventListener("error",(()=>r(new Error(`Unable to preload CSS for ${t}`))))})):void 0})))}function s(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return a.then((t=>{for(const e of t||[])"rejected"===e.status&&s(e.reason);return e().catch(s)}))},i=e.createContext({lipsyncSettings:{algorithm:"sadtalker",quality:70,useBeatAnalysis:!1,faceDetectionThreshold:.5,useLyricAlignment:!1,pads:{top:0,bottom:10,left:0,right:0},resizeFactor:1,nosmooth:!1,stillMode:!1,poseStyle:0,batchSize:2,useEnhancer:!1,preprocessMode:"crop",expressionScale:1,face3dVis:!1},voiceSettings:{model:"rvc",quality:80,enableTraining:!1,trainingEpochs:100,pitchCorrection:0},updateLipsyncSettings:()=>{},updateVoiceSettings:()=>{},getLipsyncSettingsForAPI:()=>({}),getVoiceSettingsForAPI:()=>({})}),l=({children:r})=>{const[a,s]=e.useState({algorithm:"sadtalker",quality:70,useBeatAnalysis:!1,faceDetectionThreshold:.5,useLyricAlignment:!1,pads:{top:0,bottom:10,left:0,right:0},resizeFactor:1,nosmooth:!1,stillMode:!1,poseStyle:0,batchSize:2,useEnhancer:!1,preprocessMode:"crop",expressionScale:1,face3dVis:!1}),[n,o]=e.useState({model:"rvc",quality:80,enableTraining:!1,trainingEpochs:100,pitchCorrection:0});return t.jsx(i.Provider,{value:{lipsyncSettings:a,voiceSettings:n,updateLipsyncSettings:e=>{s((t=>({...t,...e,pads:{...t.pads,...e.pads||{}}})))},updateVoiceSettings:e=>{o((t=>({...t,...e})))},getLipsyncSettingsForAPI:()=>{const{pads:e,...t}=a,r={...t,pads:`${e.top} ${e.bottom} ${e.left} ${e.right}`,resize_factor:a.resizeFactor,use_beat_analysis:a.useBeatAnalysis,use_lyric_alignment:a.useLyricAlignment,face_detection_threshold:a.faceDetectionThreshold};return"sadtalker"===a.algorithm?{...r,pose_style:a.poseStyle,batch_size:a.batchSize,still:a.stillMode,use_enhancer:a.useEnhancer,preprocess_mode:a.preprocessMode,expression_scale:a.expressionScale,ref_eyeblink:a.refEyeblink,ref_pose:a.refPose,face3d_vis:a.face3dVis,input_yaw:a.inputYaw,input_pitch:a.inputPitch,input_roll:a.inputRoll}:"geneface"===a.algorithm?{...r,frame_rate:a.frameRate,use_high_quality_mode:a.useHighQualityMode,neural_model_type:a.neuralModelType,expression_intensity:a.expressionIntensity,enable_post_processing:a.enablePostProcessing,preserve_background:a.preserveBackground,enable_super_resolution:a.enableSuperResolution,upscale_factor:a.upscaleFactor,gpu_acceleration:a.gpuAcceleration,precision:a.precision,enable_audio_preprocessing:a.enableAudioPreprocessing,enable_audio_normalization:a.enableAudioNormalization,audio_sample_rate:a.audioSampleRate,audio_path:a.audioPath}:"wav2lip"===a.algorithm?{...r,batch_size:a.batchSize,use_enhancer:a.useEnhancer,use_background_enhancer:a.useBackgroundEnhancer,preprocess_mode:a.preprocessMode,mask_dilate:a.maskDilate,mask_blur:a.maskBlur,enable_face_swap:a.enableFaceSwap,face_swap_image:a.faceSwapImage,zero_mouth:a.zeroMouth,show_frame_number:a.showFrameNumber,volume_amplification:a.volumeAmplification,delay_start_time:a.delayStartTime,enable_keyframe_manager:a.enableKeyframeManager,auto_mask:a.autoMask,driving_video:a.drivingVideo,driving_avatar:a.drivingAvatar,enable_comfy_ui:a.enableComfyUI,nosmooth:a.nosmooth}:r},getVoiceSettingsForAPI:()=>({model:n.model,quality:n.quality,enable_training:n.enableTraining,training_epochs:n.trainingEpochs,pitch_correction:n.pitchCorrection})},children:r})},c=()=>e.useContext(i),d="https://api.runpod.ai/v2/fk5lwqqdbcmom5/api/v1",u=async({text:e,faceImageFile:t,voicePreset:r="",engine:a="wav2lip"})=>{const s=new FormData;s.append("text",e),s.append("face_image",t),s.append("voice_preset",r),s.append("lip_sync_engine",a);const n=await fetch(`${d}/pipeline/process`,{method:"POST",body:s});if(!n.ok){const e=await n.text();throw new Error(`Lip sync failed: ${e}`)}return n.json()},p=async(e,t)=>{const r=new FormData;r.append("file",e);const a=await fetch(`${d}/upload/file`,{method:"POST",body:r});if(!a.ok){const e=await a.text();throw new Error(`Upload failed: ${e}`)}return t&&t(100),a.json()},m=e=>`${d}${e}`,h=async()=>{try{return(await fetch(`${d}/_ah/health`)).ok}catch{return!1}},f=e.createContext(void 0),g="wav2lip",x=({children:r})=>{const[a,s]=e.useState({wav2lip:{id:"wav2lip",name:"Wav2Lip",status:"idle"},sadtalker:{id:"sadtalker",name:"SadTalker",status:"idle"}}),[n,o]=e.useState(g),[i,l]=e.useState("idle"),[c,d]=e.useState(!1);e.useEffect((()=>{d("undefined"!=typeof window&&(window.location.hostname.includes("vercel.app")||!0))}),[]);const p=(e,t,r)=>{s((a=>({...a,[e]:{...a[e],status:t,errorMessage:r??void 0}}))),e===n&&l(t)},m=e.useCallback((async e=>{if(p(e,"loading"),c)setTimeout((()=>{p(e,"ready")}),1500);else try{const t=await u.preloadEngine(e);if(t.success&&"ready"===t.status&&!t.fallback)p(e,"ready");else{if(!t.fallback)throw new Error(t.error||`Preload failed for ${e}`);p(e,"ready",`Fallback: ${t.message||"Unknown reason"}`)}}catch(t){c?p(e,"ready"):p(e,"error",t instanceof Error?t.message:"Unknown error")}}),[n,c]);e.useEffect((()=>{m(g),l(a[g].status)}),[c]),e.useEffect((()=>{if(c)return;let e={wav2lip:0,sadtalker:0};const t=setInterval((async()=>{for(const r of Object.keys(a))try{const t=await fetch(`/api/v1/lip_sync/engine/status?engine=${r}`);if(!t.ok)throw new Error(`Status not ok: ${t.status}`);const a=await t.json();a.loaded&&"available"===a.status?(p(r,"ready"),e[r]=0):a.loaded||"unavailable"!==a.status?(p(r,"idle"),e[r]=0):(p(r,"loading"),e[r]=0)}catch(t){e[r]=(e[r]||0)+1,e[r]>=3&&p(r,"error","Failed to poll engine status")}}),2e3);return()=>clearInterval(t)}),[a,n,c]);const h=e.useCallback((async e=>{var t;if(e===n)return;if(o(e),c)return void p(e,"ready");const r=null==(t=a[e])?void 0:t.status;"ready"!==r?"loading"!==r?await m(e):l("loading"):l("ready")}),[n,a,m,c]),x="ready"===i;return t.jsx(f.Provider,{value:{engines:a,currentEngine:n,engineStatus:i,isEngineReady:x,changeEngine:h,preloadEngine:m},children:r})},b=()=>{const t=e.useContext(f);if(void 0===t)throw new Error("useEngines must be used within an EngineProvider");return t},y=()=>{const[r,a]=e.useState(null),[s,n]=e.useState(null),[o,i]=e.useState(null),[l,c]=e.useState(!1),[d,u]=e.useState(null);return t.jsxs("div",{className:"text-left",children:[t.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),u(null),i(null),!r||!s)return void u("Please upload both an audio file and an image.");const t=new FormData;t.append("qaAudio",r),t.append("image",s);try{c(!0);const e=await fetch("/api/v1/lipsync",{method:"POST",body:t}),r=await e.json();"success"===r.status?i(r.url):u("Lipsync failed.")}catch(a){u("An error occurred during upload.")}finally{c(!1)}},className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-white mb-2",children:"Audio File"}),t.jsx("input",{type:"file",accept:"audio/*",onChange:e=>{var t;return a((null==(t=e.target.files)?void 0:t[0])||null)},className:"w-full px-4 py-3 bg-slate-700/50 border border-purple-500/30 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"}),t.jsx("p",{className:"mt-1 text-sm text-gray-300",children:"Upload an audio file (.mp3, .wav) to use for lip syncing"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-white mb-2",children:"Image or Video"}),t.jsx("input",{type:"file",accept:"image/*,video/*",onChange:e=>{var t;return n((null==(t=e.target.files)?void 0:t[0])||null)},className:"w-full px-4 py-3 bg-slate-700/50 border border-purple-500/30 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"}),t.jsx("p",{className:"mt-1 text-sm text-gray-300",children:"Upload an image or video file (.jpg, .png, .mp4)"})]}),t.jsx("button",{type:"submit",disabled:l,className:"w-full px-6 py-3 bg-purple-600 text-white font-medium rounded-md shadow-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-opacity-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 flex justify-center items-center",children:l?t.jsxs(t.Fragment,{children:[t.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}):"Generate Lipsync"})]}),d&&t.jsx("div",{className:"mt-6 p-4 bg-red-900/50 border border-red-500 rounded-md",children:t.jsx("p",{className:"text-red-200",children:d})}),o&&t.jsxs("div",{className:"mt-8",children:[t.jsx("h3",{className:"text-xl font-semibold mb-4 text-white",children:"Result"}),t.jsx("div",{className:"overflow-hidden rounded-md border border-purple-500/50 bg-black",children:t.jsx("video",{src:o,controls:!0,className:"w-full h-auto",poster:"/placeholder-video.jpg"})}),t.jsx("div",{className:"mt-4",children:t.jsxs("a",{href:o,download:!0,className:"inline-flex items-center px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-md",children:[t.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download Video"]})})]})]})};class w extends r.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,t){this.setState({error:e,errorInfo:t})}render(){return this.state.hasError?t.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-[#09090b] to-[#1a1a2e] flex flex-col items-center justify-center p-8 text-white",children:[t.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Something went wrong loading the UI"}),t.jsxs("div",{className:"bg-red-900/50 p-4 rounded-md border border-red-500 max-w-2xl w-full overflow-auto mb-4",children:[t.jsx("p",{className:"font-mono text-sm",children:this.state.error&&this.state.error.toString()}),this.state.errorInfo&&t.jsx("pre",{className:"mt-2 text-xs text-red-200 overflow-auto max-h-[300px]",children:this.state.errorInfo.componentStack})]}),t.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-md",children:"Reload Page"})]}):this.props.children}}const v=()=>{const[r,a]=e.useState({Header:null,Sidebar:null,VideoPlayer:null}),[s,n]=e.useState({Header:null,Sidebar:null,VideoPlayer:null});e.useEffect((()=>{(async()=>{try{const e=await o((()=>import("./Header-0obamvo2.js")),__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url);n((t=>({...t,Header:e.default})))}catch(e){a((t=>({...t,Header:e.toString()})))}try{const e=await o((()=>import("./Sidebar-BQRjCmiW.js")),__vite__mapDeps([7,1,4,2,3,6]),import.meta.url);n((t=>({...t,Sidebar:e.default})))}catch(e){a((t=>({...t,Sidebar:e.toString()})))}try{const e=await o((()=>import("./VideoPlayer-C1tvV8o4.js")),__vite__mapDeps([8,1,2,4,3,5]),import.meta.url);n((t=>({...t,VideoPlayer:e.default})))}catch(e){a((t=>({...t,VideoPlayer:e.toString()})))}})()}),[]);const i=s.Header,l=s.Sidebar,c=s.VideoPlayer,d=Object.values(r).some((e=>null!==e));return t.jsxs("div",{className:"app-container",children:[" ",d?t.jsx("div",{className:"w-full flex items-center justify-center",children:t.jsxs("div",{className:"max-w-3xl w-full p-8 bg-slate-800/80 backdrop-blur-sm rounded-lg border border-purple-500/50",children:[t.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Component Loading Errors"}),t.jsx("div",{className:"space-y-4",children:Object.entries(r).map((([e,r])=>r?t.jsxs("div",{className:"p-4 bg-red-900/50 border border-red-500/50 rounded-md",children:[t.jsxs("p",{className:"font-medium text-white",children:[e," Error:"]}),t.jsx("pre",{className:"text-sm text-red-200 mt-2 overflow-auto max-h-[150px]",children:r})]},e):null))}),t.jsxs("div",{className:"mt-8",children:[t.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Fallback UI"}),t.jsx(y,{})]})]})}):t.jsxs(t.Fragment,{children:[l&&t.jsx(l,{})," ",t.jsxs("div",{className:"flex flex-col flex-1",children:[" ",i&&t.jsx(i,{onTTSToggle:()=>{}})," ",t.jsx("main",{className:"flex-1 p-4 overflow-auto bg-gradient-to-b from-[#09090b] to-[#1a1a2e] flex flex-col items-center justify-center",children:c?t.jsx(c,{}):t.jsx(y,{})})]})]})]})};function _(){return t.jsx(w,{children:t.jsx(x,{children:t.jsx(l,{children:t.jsx(v,{})})})})}o((()=>import("./runpodTest-DOassHFb.js")),__vite__mapDeps([9,1,2]),import.meta.url).catch((e=>{}));const j=document.getElementById("root");j&&a(j).render(t.jsx(s,{children:t.jsx(_,{})}));export{b as a,p as b,m as g,u as l,h as t,c as u};
